{"name":"Pompa","type":"virtual_device","properties":{"deviceIcon":0,"categories":"[\"other\"]","currentIcon":"0","log":"","logTemp":"","mainLoop":"--local piec = Net.FHttp('10.11.12.51', 80);\n----piec:setReadTimeout(250);\n--local response,status,errorCode = piec:GET('/');\nlocal device = fibaro:getSelfId();\nlocal duration = fibaro:getValue(device, \"ui.Label2.value\");\nlocal max_duration = 1800;-- seconds\nif (duration == nil)\n  then\n  fibaro:debug(\"value not set, setting\")\n  dunation = 0\nend\n-- --fibaro:debug(device);\n-- --fibaro:debug(\"#\"..errorCode..\"#\" );\n--fibaro:debug(\"duration: \" .. duration);\n\n--if (tonumber(status)~=200) \n--then\n--  \tfibaro:log(\"Error \" .. errorCode .. \".\");\n--    fibaro:debug(\"Label Error\");\n\t\n--  \t--local msg = \"home.fibaro.piec.status 99 \" .. os.time() ..\" \\n\"; \n--  \tfibaro:call(device, \"setProperty\", \"ui.Label1.value\", \"ERROR\");\n--  \tfibaro:setGlobal(\"Piec\",\"ERROR\")\n  \t\n  \t\n--else \n--\tif ( tonumber(string.find(response,\"ON\")) ~= nil  )\n--\tthen\n--\t\tfibaro:debug(\"Label ON\");\n--    \t--local msg = \"home.fibaro.piec.status 1 \" .. os.time() ..\" \\n\"; \n--\t\tfibaro:call(device, \"setProperty\", \"ui.Label1.value\", \"ON\");\n--    \tfibaro:setGlobal(\"Piec\",\"ON\");\n--      \tduration = duration + 1;\n--     \tfibaro:call(device, \"setProperty\", \"ui.Label2.value\", tonumber(duration));\n--    \t\n--\telse \n-- \t\t--if ( tonumber(string.find(response,\"OFF\")) ~= nil )\n--  \t\t--then\t\n--      \tfibaro:debug(\"Label OFF\");\n--  \t\t--local msg = \"home.fibaro.piec.status 0 \" .. os.time() ..\" \\n\"; \n--\t\tfibaro:call(device, \"setProperty\", \"ui.Label1.value\", \"OFF\");\n--    \tfibaro:setGlobal(\"Piec\",\"OFF\")\n--    \tduration = 0;\n--        fibaro:call(device, \"setProperty\", \"ui.Label2.value\", tonumber(duration));\n--\t\t--end\n--  \tend\n    \n-- end\n\n-- --fibaro:sleep(10*1000);\n","ui.Label1.value":"ON","ui.status.value":"","visible":"true","rows":[{"type":"label","elements":[{"id":1,"lua":false,"waitForResponse":false,"caption":"Status:","name":"Label1","favourite":false,"main":true}]},{"type":"button","elements":[{"id":2,"lua":true,"waitForResponse":false,"caption":"ON","name":"Button11","empty":false,"msg":"local switch = 63\n--local HC2 = Net.FHttp('10.11.12.51', 80);\n--local response,status,errorCode = HC2:GET('/RELAY=ON');\nlocal device = fibaro:getSelfId();\n\nfibaro:call(device, \"setProperty\", \"ui.Label1.value\", \"ON\");\nfibaro:call(switch, \"turnOn\");\nfibaro:setGlobal(\"Piec\",\"ON\")\n--local response,status,errorCode = HC2:GET('/');\n\n--fibaro:debug(response);\n","buttonIcon":0,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":3,"lua":true,"waitForResponse":false,"caption":"OFF","name":"Button21","empty":false,"msg":"local switch = 63\n--local HC2 = Net.FHttp('10.11.12.51', 80);\n--local response,status,errorCode = HC2:GET('/RELAY=OFF');\nlocal device = fibaro:getSelfId();\nfibaro:call(switch, \"turnOff\");\nfibaro:call(device, \"setProperty\", \"ui.Label1.value\", \"OFF\");\nfibaro:setGlobal(\"Piec\",\"OFF\")\n--local response1,status,errorCode = HC2:GET('/');\n\n--fibaro:debug(response1);\n","buttonIcon":0,"favourite":false,"main":false}]},{"type":"label","elements":[{"id":4,"lua":false,"waitForResponse":false,"caption":"Status:","name":"status","favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}